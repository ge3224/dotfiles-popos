- name: Install i3 if not present
  become: true
  apt:
    name:
      - i3
    state: present

- name: Install light utility
  package:
    name: light
    state: present

- name: Configure sudoers file
  become: true
  lineinfile:
    path: /etc/sudoers
    line: "{{ username }} ALL=(ALL) NOPASSWD: /usr/bin/light"
    validate: 'visudo -cf %s'
  when: username != "root"

- name: Get stat of i3 config
  ansible.builtin.stat:
    path: /home/{{ username }}/.config/i3
  register: i3_stat

- name: Remove any i3 config that is not a symlink
  ansible.builtin.file:
    path: /home/{{ username }}/.config/i3
    state: absent
  when: i3_stat.stat.isdir is defined and i3_stat.stat.isdir

- name: Unlink i3 config if it's a symlink
  file:
    path: /home/{{ username }}/.config/i3
    state: absent
  when: i3_stat.stat.exists and i3_stat.stat.islnk

- name: Creating a symlink to i3 config
  ansible.builtin.file:
    src: "{{ playbook_dir }}/dotfiles/i3/.config/i3"
    dest: /home/{{ username }}/.config/i3
    state: link

- name: Get stat of i3status
  ansible.builtin.stat:
    path: /home/{{ username }}/.config/i3status
  register: i3status_stat

- name: Remove any i3status config that is not a symlink
  ansible.builtin.file:
    path: /home/{{ username }}/.config/i3status
    state: absent
  when: i3status_stat.stat.isdir is defined and i3status_stat.stat.isdir

- name: Unlink i3status config if it's a symlink
  file:
    path: /home/{{ username }}/.config/i3status
    state: absent
  when: i3status_stat.stat.exists and i3status_stat.stat.islnk

- name: Creating a symlink from i3status config
  ansible.builtin.file:
    src: "{{ playbook_dir }}/dotfiles/i3/.config/i3status"
    dest: /home/{{ username }}/.config/i3status
    state: link
